# JOIN

JOIN в SQL — это оператор для объединения строк из двух (или более) таблиц в одну выборку на основе определённого условия. Обычно это условие связывает строки через общие поля. Основные виды JOIN в SQL:

* **INNER JOIN**
* **LEFT JOIN** (или LEFT OUTER JOIN)
* **RIGHT JOIN** (или RIGHT OUTER JOIN)
* **FULL JOIN** (или FULL OUTER JOIN)
* **CROSS JOIN**
* **SELF JOIN**

## INNER JOIN

**INNER JOIN** выбирает только те строки, у которых совпадают значения в объединяемых полях обеих таблиц. Если условие объединения не выполняется, строка не попадает в результат.

```SQL
SELECT employees.name, departments.department_name
FROM employees
INNER JOIN departments ON employees.department_id = departments.id;
```

В этом примере результат будет включать только те строки, где department_id в таблице employees совпадает с id в таблице departments. Все строки, у которых нет соответствий, будут исключены.

### Когда использовать INNER JOIN

* Когда нужны только совпадающие записи из обеих таблиц.
* При необходимости отфильтровать данные так, чтобы получить пересечение двух таблиц.

## LEFT JOIN (LEFT OUTER JOIN)

LEFT JOIN включает все строки из левой таблицы (той, которая указана первой), и добавляет строки из правой таблицы, если есть совпадение по условию. Если совпадений нет, строки из левой таблицы всё равно попадают в результат, а поля из правой таблицы заполняются NULL.

```SQL
SELECT employees.name, departments.department_name
FROM employees
LEFT JOIN departments ON employees.department_id = departments.id;
```

Здесь все строки из employees будут включены в результат. Если у сотрудника нет соответствующего департамента, поле department_name будет заполнено NULL.

### Когда использовать LEFT JOIN

* Когда нужно получить все строки из одной таблицы, даже если для них нет соответствий в другой таблице.
* В ситуациях, когда отсутствующие значения из правой таблицы имеют смысл (например, сотрудники без назначенного департамента).

## RIGHT JOIN (RIGHT OUTER JOIN)

RIGHT JOIN работает аналогично LEFT JOIN, но включает все строки из правой таблицы. Если для строки правой таблицы нет совпадения в левой, то её поля из левой таблицы будут заполнены NULL.

```SQL
SELECT employees.name, departments.department_name
FROM employees
RIGHT JOIN departments ON employees.department_id = departments.id;
```

Результат будет включать все строки из departments. Если в таблице employees нет сотрудников для какого-либо департамента, то в соответствующих полях employees будут NULL.

### Когда использовать RIGHT JOIN

* Когда приоритетна правая таблица, и вы хотите получить все её строки.
* Когда есть таблицы, связанные таким образом, что одна таблица (правая) важнее, чем другая (левая).

## FULL JOIN (FULL OUTER JOIN)

FULL JOIN возвращает все строки из обеих таблиц, даже если для каких-то строк нет совпадений. Если для строки одной таблицы нет соответствующей строки в другой, то для неё будут заполнены NULL-значения.

```SQL
SELECT employees.name, departments.department_name
FROM employees
FULL JOIN departments ON employees.department_id = departments.id;
```

Результат будет включать:

* строки, у которых есть совпадения в обеих таблицах,
* строки из employees, для которых нет соответствующих департаментов (поля департамента будут NULL),
* строки из departments, для которых нет сотрудников (поля сотрудников будут NULL).

### Когда использовать FULL JOIN

* Когда нужно получить все данные из обеих таблиц.
* При анализе данных, чтобы не потерять строки из обеих таблиц, даже если нет соответствий.

## CROSS JOIN

CROSS JOIN возвращает декартово произведение (каждую строку первой таблицы сочетает с каждой строкой второй таблицы). Результат содержит количество строк, равное произведению числа строк в обеих таблицах.

```SQL
SELECT employees.name, departments.department_name
FROM employees
CROSS JOIN departments;
```

Если в employees 10 записей, а в departments — 5, результатом будет 50 строк (10 x 5), независимо от совпадений.

### Когда использовать CROSS JOIN

* Когда нужно произвести каждую возможную комбинацию записей из двух таблиц.
* Редко используется на практике, если только не требуется декартово произведение, например, для комбинаций в аналитике или при моделировании.

## SELF JOIN

SELF JOIN — это техника соединения таблицы самой с собой. Потребность в SELF JOIN возникает, когда необходимо сравнить записи одной таблицы друг с другом.

```SQL
SELECT e1.name AS employee_name, e2.name AS manager_name
FROM employees e1
JOIN employees e2 ON e1.manager_id = e2.id;
```

Этот запрос выдаст список сотрудников вместе с их менеджерами, где manager_id указывает на другую строку в той же таблице.

### Когда использовать SELF JOIN

Когда требуется сопоставить данные одной таблицы с другой её частью (например, иерархия менеджер-подчинённый, сопоставление данных с предыдущими значениями).

## Заключение

* Используйте INNER JOIN, когда вам нужны только совпадающие строки.
* Применяйте LEFT JOIN, когда хотите получить все строки из левой таблицы, даже если в правой таблице нет соответствия.
* Используйте RIGHT JOIN, когда нужны все строки из правой таблицы.
* Используйте FULL JOIN, чтобы не упустить ни одной строки из обеих таблиц.
* CROSS JOIN полезен для декартовых произведений.
* SELF JOIN нужен для сравнений между строками одной таблицы.
